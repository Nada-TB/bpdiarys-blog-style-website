<?php
// Check if $articles is defined and is an array
if (!isset($articles) || !is_array($articles) || count($articles) === 0) : ?>
    <div class="error">
        <p>The budding programmer diary coming soon, stay connected!</p>
        <img src="css/images/bpdMan.png" alt="the bpdiarys man">
    </div>
<?php else : ?>
    <div id="homePage">

        <?php foreach ($articles as $article) : ?>
            <?php
            // Sanitize and prepare variables for safe output
            $articleTitle = htmlentities($article['title'], ENT_QUOTES, 'UTF-8');
            $content = htmlentities(substr($article['content'], 0, 200), ENT_QUOTES, 'UTF-8');
            $timeDate = htmlentities($article['timeDate'], ENT_QUOTES, 'UTF-8');
            $writer = ucwords(htmlentities($article['writer'], ENT_QUOTES, 'UTF-8'));
            $articleId = intval($article['id']);
            $encodedTitle = urlencode( $articleTitle);
            ?>

            <article>
                <h2>&#60;&#47; <?= $articleTitle ?> &#62;</h2>
                <p class="home1">&#147; <?= $content ?> [...] &#148;</p>
                <p class="home"></p>
                <span><i class="far fa-clock"></i> <?= $timeDate ?> by <?= ucwords(htmlentities($article['writer'], ENT_QUOTES, 'UTF-8')) ?></span>
                <a href="index.php?action=article&articleId=<?= urlencode($articleId)  ?>" title="Click here to show the post"><button>read more</button></a>
                <?php if ($checkConnected) : ?>
                    <a href="index.php?action=addFavorite&title=<?= $encodedTitle ?>&favoriteId=<?= urlencode($articleId) ?>"><button title="save the article to read it after">save</button></a>
                <?php else : ?>
                    <button title="No time to read it? Click here to save it" id="save">save</button>
                <?php endif; ?>

            </article>

        <?php endforeach; ?>

    </div>
<?php endif; ?>